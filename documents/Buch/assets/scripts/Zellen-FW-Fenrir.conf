# David Koch - 5CN HTL3R
# Diplomarbeit Fenrir
# Zellen-Firewall --> ALT PFUI NICHT FERTIG DIENT NUR FÜR TEMPORÄRE ZWECKE OK

# execute factoryreset

# Weil der Factory Reset nervige Konfigurationen mit sich bringt...
config firewall policy
    delete 1
end

config system dhcp server
    delete 1
end

config system virtual-switch
    delete internal
end

config system global
    set switch-controller disable
end

config system interface
    edit wan1
        set mode static
    next
    edit wan2
        set mode static
    next
end

# Ab hier geht der echte Spaß los

config system global
    set admintimeout 30
    set hostname "Zellen-FW-Fenrir"
    set timezone 26
    set vdom-mode multi-vdom
end
y

config vdom
    edit VDOM-CELL-1
        config firewall address
            edit "SIMATIC"
                set subnet 10.79.84.1 255.255.255.255
                set comment "Siemens SIMATIC PLC"
            next
            edit "SCADA"
                set subnet 10.34.0.50 255.255.255.255
                set comment "SCADA-LTS"
            next
        end
        config firewall service category
            edit "Bus"
                set comment "TCP/IP Encapsulated Bus Protocols"
            next
        end
        config firewall service custom
            edit "MODBUS_TCP"
                set category "Bus"
                set protocol TCP
                set helper disable
                set color 17
                # set tcp-portrange ???
                # set tcp-... yknow the deal
            next
        config firewall policy
            edit 1
                set name "SCADA_to_SIMATIC"
                set srcintf "wan1"
                set dstintf "internal1"
                set srcaddr "SCADA"
                set dstaddr "SIMATIC"
                # temp accept all!!!
                # set send-deny-packet enable ?
                set anti-replay enable
                set action accept
                set schedule "always"
                set service "PING MODBUS_TCP"
                set logtraffic all
                set status enable
            next
        end
    next
    edit VDOM-CELL-2
        config firewall address
            edit "OpenPLC"
                set subnet 10.79.84.5 255.255.255.255
                set comment "OpenPLC PLC (Raspberry Pi)"
            next
            edit "SCADA"
                set subnet 10.34.0.50 255.255.255.255
                set comment "SCADA-LTS"
            next
        end
    next
    edit VDOM-CELL-3
        config firewall address
            edit "LOGO!"
                set subnet 10.79.84.9 255.255.255.255
                set comment "Siemens LOGO! PLC"
            next
            edit "SCADA"
                set subnet 10.34.0.50 255.255.255.255
                set comment "SCADA-LTS"
            next
        end
    next
end

config global
    config sys interface
        edit wan1
            set description "To Seperation Firewall"
            set vdom "root"
            set ip 172.16.10.5 255.255.255.252
            set allowaccess ping
            set type physical
            set snmp-index 1
        next
        edit internal1
            set description "To Siemens SIMATIC PLC"
            set vdom "VDOM-CELL-1"
            set role lan
            set mode static
            set mirror "internal4"
            set ip 10.79.84.2 255.255.255.252
            set allowaccess ping
            set type physical
            set snmp-index 2
        next
        edit internal2
            set description "To OpenPLC PLC"
            set vdom "VDOM-CELL-2"
            set role lan
            set mode static
            set mirror "internal4"
            set ip 10.79.84.6 255.255.255.252
            set allowaccess ping
            set type physical
            set snmp-index 3
        next
        edit internal3
            set description "To Siemens LOGO! PLC"
            set vdom "VDOM-CELL-3"
            set role lan
            set mode static
            set mirror "internal4"
            set ip 10.79.84.10 255.255.255.252
            set allowaccess ping
            set type physical
            set snmp-index 4
        next
        edit internal4
            set vdom "root"
            # ???? ip
            set type undefined
            set snmp-index 5
        next
    end
end

config router static
    edit 1
        set gateway 172.16.10.6
        set device "wan1"
    next
end

config log setting
    set status enable
    set logmemory enable
    set log-disk-full overwrite
    set severity warning
end

config log syslogd setting
    set status enable
    set server "192.168.31.100"
    set mode udp
    set port 514
    set facility local7
end

exit
# Konfiguration sollte automatisch nach dem exit bzw. der Abmeldung gespeichert werden :^)

